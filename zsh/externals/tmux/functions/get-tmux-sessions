#!/bin/zsh

local current_session=$(echo $([[ ! -z $TMUX ]] && echo $(tmux display -p -F "#{session_name}" 2>/dev/null)))
if [ "$current_session" = "popup" ]; then
    eval $(tmux showenv -gs TMUX_LAST_DETECTED_SESSION)
    local from_session=$TMUX_LAST_DETECTED_SESSION
else
    local from_session=$current_session
fi
local active_sessions_with_configs=$({ get-tmux-active-sessions; get-tmux-sessions-with-configs; } | sort | uniq -d | awk NF)
local inactive_sessions_with_configs=$({ get-tmux-sessions-with-configs; echo ${active_sessions_with_configs}; } | sort | uniq -u | awk NF)
{ echo $(get-tmux-active-sessions) | awk 'NF'; \
    [ ! -z $inactive_sessions_with_configs ] && echo $inactive_sessions_with_configs | sed 's/.*/(&)/' } | grep -v ${from_session:-' '}
